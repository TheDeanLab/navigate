<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contributing Guidelines &mdash; navigate 0.0.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Feature Container" href="feature_container.html" />
    <link rel="prev" title="Software Architecture" href="software_architecture.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            navigate
              <img src="../_static/mic.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_installation.html">Software Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i_want_to.html">I Want To…</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/hardware_overview.html">Supported Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/gui_walkthrough.html">User Interface Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/setup_microscope.html">Setting Up A Microscope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/acquiring_home.html">Acquiring Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/REST-apis/ilastik_segmentation.html">Analyzing Images via REST-API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/case_studies/case_studies_home.html">Case Studies</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="software_architecture.html">Software Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contributing Guidelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-principles">General Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#coding-style">Coding Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="#communicating-with-hardware">Communicating with Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scientific-units">Scientific Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-commit-hooks">Pre-Commit Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dictionary-parsing">Dictionary Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#developing-with-a-mac">Developing with a Mac</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shared-memory-limits">Shared memory limits</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="feature_container.html">Feature Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugin/plugin_home.html">Plugin Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">navigate</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Contributing Guidelines</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/contributing/contributing_guidelines.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="contributing-guidelines">
<h1>Contributing Guidelines<a class="headerlink" href="#contributing-guidelines" title="Permalink to this heading"></a></h1>
<p>We welcome contributions in the form of bug reports, bug fixes, new features
and documentation. If you are contributing code, please create it in a fork and
branch separate from the main <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch and then make a pull request
to the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch for code review. Some best practices for new code are
outlined below.</p>
<p>If you are considering refactoring part of the code, please reach out to us prior to
starting this process. We are happy to invite you to our regular software development
meeting.</p>
<hr class="docutils" />
<section id="general-principles">
<h2>General Principles<a class="headerlink" href="#general-principles" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>We use a <a class="reference external" href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">model-view-controller architecture</a>.
New functionality should keep this strong separation. More information can be found
in the <a class="reference internal" href="software_architecture.html"><span class="doc">software architecture</span></a> section.</p></li>
<li><p>Please do not create new configuration variables unless absolutely
necessary, especially in the <code class="docutils literal notranslate"><span class="pre">configuration.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">experiment.yaml</span></code>
files. A new variable is necessary only if no variable stores similar
information or there is no way to use the most similar variable without
disrupting another part of the code base.</p></li>
<li><p>We are happy to discuss code refactors for improved clarity and speed.
However, please do not modify something that is already working without
discussing this with the software team in advance.</p></li>
<li><p>All code that modifies microscope control behavior must be reviewed and tested on a
live system prior to merging into the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="coding-style">
<h2>Coding Style<a class="headerlink" href="#coding-style" title="Permalink to this heading"></a></h2>
<p>We follow the <a class="reference external" href="https://peps.python.org/pep-0008/">PEP8 code style guide</a>.
All class names are written in <code class="docutils literal notranslate"><span class="pre">CamelCase</span></code> and all
variable names are <code class="docutils literal notranslate"><span class="pre">lowercase_and_separated_by_underscores</span></code>.</p>
</section>
<hr class="docutils" />
<section id="communicating-with-hardware">
<h2>Communicating with Hardware<a class="headerlink" href="#communicating-with-hardware" title="Permalink to this heading"></a></h2>
<p>In handling hardware devices, such as Sutter’s MP-285A stage, using threads can introduce
complexities, especially when simultaneous read and write operations occur over a
shared resource like a serial line. An encountered issue demonstrated the challenges
when two different threads attempted to write to and read from the same serial port
simultaneously. This action led to data corruption due to interleaving of
read/write calls that require precise handshaking, characteristic of the MP-285A’s
communication protocol. The solution involved implementing a blocking mechanism using
<cite>threading.Event()</cite> to ensure that operations on the serial port do not overlap,
showcasing the difficulties of multithreading sequential processes. To mitigate such
issues, a design where each hardware device operates within its own dedicated thread is
advisable. This approach simplifies the management of device communications by enforcing
sequential execution, eliminating the need to handle complex concurrency issues inherent
in multithreading environments. This strategy ensures robust and error-free interaction
with hardware devices.</p>
</section>
<hr class="docutils" />
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading"></a></h2>
<p>We use <a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> to generate
documentation from documented methods, attributes, and classes. Please document
all new methods, attributes, and classes using a Sphinx compatible version of
<a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/example_numpy.html">Numpydoc</a>.</p>
</section>
<hr class="docutils" />
<section id="scientific-units">
<h2>Scientific Units<a class="headerlink" href="#scientific-units" title="Permalink to this heading"></a></h2>
<p>Please express quantities in the following units when they are in the standard model/
view/controller code. Deviations from this can occur where it is necessary to pass a
different unit to a piece of hardware.</p>
<ul class="simple">
<li><p>Time - Milliseconds</p></li>
<li><p>Distance - Micrometers</p></li>
<li><p>Voltage - Volts</p></li>
<li><p>Rotation - Degrees</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="pre-commit-hooks">
<h2>Pre-Commit Hooks<a class="headerlink" href="#pre-commit-hooks" title="Permalink to this heading"></a></h2>
<p>We use <a class="reference external" href="https://pre-commit.com/">pre-commit hooks</a> to enforce consistent code
formatting and automate some of the code review process. In some rare cases, the
linter may complain about a line of code that is actually fine. For example, in
the example code below, Ruff linter complains that the start_stage class is
imported but not used. However, it is actually used in as part of an
<code class="docutils literal notranslate"><span class="pre">exec</span></code> statement.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">navigate.model.device_startup_functions</span> <span class="kn">import</span> <span class="n">start_stage</span>
<span class="n">device_name</span> <span class="o">=</span> <span class="n">stage</span>
<span class="n">exec</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;self.</span><span class="si">{</span><span class="n">device_name</span><span class="si">}</span><span class="s2"> = start_</span><span class="si">{</span><span class="n">device_name</span><span class="si">}</span><span class="s2">(name, device_connection, configuration, i, is_synthetic)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To avoid this error, add a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">noqa</span></code> comment to the end of the line to tell Ruff to ignore the error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">navigate.model.device_startup_functions</span> <span class="kn">import</span> <span class="n">start_stage</span>  <span class="c1"># noqa</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="dictionary-parsing">
<h2>Dictionary Parsing<a class="headerlink" href="#dictionary-parsing" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="../user_guide/software_configuration.html"><span class="doc">configuration file</span></a> is loaded as a
large dictionary object, and it is easy to create small errors in the dictionary that
can crash the program. To avoid this, when getting properties from the configuration
dictionary, it is best to use the <code class="docutils literal notranslate"><span class="pre">.get()</span></code> command, which provides you with the
opportunity to also have a default value should the key provided not be found. For
example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Galvo Waveform Information</span>
<span class="bp">self</span><span class="o">.</span><span class="n">galvo_waveform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;sawtooth&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, we try to retrieve the <code class="docutils literal notranslate"><span class="pre">waveform</span></code> key from a the <code class="docutils literal notranslate"><span class="pre">self.device_config</span></code>
dictionary.  In the case that this key is not available, it then by default returns
<code class="docutils literal notranslate"><span class="pre">sawtooth</span></code>. If however the <code class="docutils literal notranslate"><span class="pre">waveform</span></code> key is found, it will provide the value
associated with it.</p>
</section>
<hr class="docutils" />
<section id="unit-tests">
<h2>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this heading"></a></h2>
<p>Each line of code is unit tested to ensure it behaves appropriately
and alert future coders to modifications that break expected functionality.
Guidelines for writing good unit tests can be found <a class="reference external" href="https://stackoverflow.com/questions/61400/what-makes-a-good-unit-test">here</a>
and <a class="reference external" href="https://medium.com/chris-nielsen/so-whats-a-good-unit-test-look-like-71f750333ac0">over here</a>,
or in examples of unit tests in this repository’s <code class="docutils literal notranslate"><span class="pre">test</span></code> folder. We
use the <a class="reference external" href="https://docs.pytest.org/en/7.2.x/">pytest library</a> to evaluate unit
tests. Please check that unit tests pass on your machine before making a pull request.</p>
</section>
<hr class="docutils" />
<section id="developing-with-a-mac">
<h2>Developing with a Mac<a class="headerlink" href="#developing-with-a-mac" title="Permalink to this heading"></a></h2>
<p>Many of us have Apple products and use them for development.
However, there are some issues that you may encounter when developing on a Mac.
Below are some of the issues we have encountered and how to resolve them.</p>
<hr class="docutils" />
<section id="shared-memory-limits">
<h3>Shared memory limits<a class="headerlink" href="#shared-memory-limits" title="Permalink to this heading"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">OSError: You tried to simultaneously open more SharedNDArrays than are</span>
<span class="go">allowed by your system!</span>
</pre></div>
</div>
<p>This results from a limitation in the number of shared memory objects that can
be created on a Mac. To figure out how many objects can open, open a terminal and
run the following command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ulimit -n</span>
</pre></div>
</div>
<p>To increase this number, simply add an integer value after it. In our hands, 1000
typically works:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ulimit -n 1000</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="software_architecture.html" class="btn btn-neutral float-left" title="Software Architecture" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="feature_container.html" class="btn btn-neutral float-right" title="Feature Container" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Dean Lab, UT Southwestern Medical Center.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>